{% extends 'base.html' %}
{% load static %}
{% load bootstrap3 %}
{% load account_extras %}
{% load django_tables2 %}

{% block content-h1 %}
    Settings
{% endblock %}

{% block breadcrumbs %}
    <ol class="breadcrumb">
        <li><a href="{% url 'dashboard' %}"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Settings</li>
    </ol>
{% endblock %}

{% block content %}
    <!-- Default box -->
    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title">House filters list</h3>
        </div>
        <div class="box-body">
            <div class="nav-tabs-custom">

                {% include 'accounts/_partial/tabs.html' %}

                <div class="tab-pane active" id="tab_filters">
                    <div class="checkbox">
                        <label>
                            <input
                                    type="checkbox"
                                    id="show_title_photo"
                                    value="1"
                                    {% if request.user.profile.show_photos_filters %}checked="checked"{% endif %}
                            > Show title photo
                        </label>
                    </div>
                    <p><a class="btn btn-primary" href="{% url 'accounts:create_filter' %}"><i class="fa fa-plus" aria-hidden="true"></i> Create filter</a></p>
                    <br>
                    {% render_table filters_table %}
                </div>
                <!-- /.tab-content -->
            </div>
        </div>
        <!-- /.box-body -->
        <div class="box-footer">

        </div>
        <!-- /.box-footer-->
    </div>
    <!-- /.box -->
{% endblock %}

{% block styles %}
<link href="{% static 'django_tables2/bootstrap.css' %}" rel="stylesheet" />
{% endblock %}

{% block scripts %}
    <script>
        $("#show_title_photo").change(function () {
            $.post( "{% url 'accounts:change_show_title_photo' %}", { value: + $("#show_title_photo").is(':checked') })
                    .fail(function() {
                        alert( "Error saving data!" );
                    });
        });

        $('body').on('click', 'td.disabled a', function(e) {
            e.preventDefault();
            var $this = $(this).parent();
            var oldHTML = $this.html();
            $this.html('Updating...');
            var id = $this.siblings().first(".id").html();
            $.post( '/accounts/settings/filters/toggle-disabled/' + id + '/' )
                .fail(function() {
                    $this.html(oldHTML);
                    alert( "Error sending data!" );
                })
                .success(function(data) {
                    var html = '<a href="#"><span class="false">✘</span></a>';
                    if (data.disabled == true) {
                        var html = '<a href="#"><span class="true">✔</span></a>';
                    }
                    $this.html(html);
                });
        });
    </script>
{% endblock %}